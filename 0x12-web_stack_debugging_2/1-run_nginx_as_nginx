#!/usr/bin/env bash
# Create a backup of the original Nginx configuration file
mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig

# Create a new Nginx configuration file with the necessary changes
cat << EOF > /etc/nginx/nginx.conf
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /var/run/nginx.pid;
events {
    worker_connections 1024;
}
http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log /var/log/nginx/access.log;
    sendfile on;
    keepalive_timeout 65;
    server {
        listen 8080;
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
        }
    }
}
EOF

# Set the appropriate permissions for the new configuration file
chown nginx:nginx /etc/nginx/nginx.conf

# Start Nginx
nginx

# Check if Nginx is running as the nginx user
ps auxff | grep '[n]ginx'

# Check if Nginx is listening on port 8080
nc -z 0 8080
